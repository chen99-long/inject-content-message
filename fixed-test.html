<!DOCTYPE html>
<html>
<head>
    <title>ä¿®å¤åçš„æµ‹è¯•</title>
    <script src="./dist/index.umd.js"></script>
</head>
<body>
    <h1>ä¿®å¤åçš„ sendEvent æµ‹è¯•</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            const div = document.createElement('div');
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            output.appendChild(div);
            console.log(message);
        }
        
        async function runTest() {
            try {
                const { defineEventMessaging } = InjectContentMessage;
                const { sendEvent, listenEvent } = defineEventMessaging();
                
                log('ğŸ¯ è®¾ç½®äº‹ä»¶ç›‘å¬å™¨...');
                
                // ç›‘å¬å™¨ï¼šå¤„ç†æ¶ˆæ¯å¹¶è¿”å›å“åº”
                listenEvent("injectMessage", async (message) => {
                    log(`ğŸ“¨ ç›‘å¬å™¨æ”¶åˆ°æ¶ˆæ¯: ${JSON.stringify(message)}`);
                    return `Hello from inject script! æ”¶åˆ°äº†: ${JSON.stringify(message)}`;
                });
                
                log('âœ… ç›‘å¬å™¨è®¾ç½®å®Œæˆ');
                
                // ç­‰å¾…ä¸€ä¸‹ç¡®ä¿ç›‘å¬å™¨å·²è®¾ç½®
                await new Promise(resolve => setTimeout(resolve, 200));

                sendEvent("injectMessage", "Hello from content script").then(res=>{
                    console.log(111,res);
                    
                })
                
                log('<br>ğŸ“¤ <strong>æµ‹è¯•1: å‘é€å­—ç¬¦ä¸²æ•°æ®</strong>');
                const result1 = await sendEvent("injectMessage", "Hello from content script");
                log(`âœ… æ”¶åˆ°å›è°ƒ: <span style="color: green;">${result1}</span>`);
                
                log('<br>ğŸ“¤ <strong>æµ‹è¯•2: å‘é€æ•°å­—æ•°æ®</strong>');
                const result2 = await sendEvent("injectMessage", 42);
                log(`âœ… æ”¶åˆ°å›è°ƒ: <span style="color: green;">${result2}</span>`);
                
                log('<br>ğŸ“¤ <strong>æµ‹è¯•3: å‘é€å¯¹è±¡æ•°æ®</strong>');
                const result3 = await sendEvent("injectMessage", { type: "test", value: 123 });
                log(`âœ… æ”¶åˆ°å›è°ƒ: <span style="color: green;">${result3}</span>`);
                
                log('<br>ğŸ“¤ <strong>æµ‹è¯•4: å‘é€å¸ƒå°”å€¼</strong>');
                const result4 = await sendEvent("injectMessage", true);
                log(`âœ… æ”¶åˆ°å›è°ƒ: <span style="color: green;">${result4}</span>`);
                
                log('<br>ğŸ‰ <strong>æ‰€æœ‰æµ‹è¯•å®Œæˆï¼ç°åœ¨ sendEvent æ”¯æŒä»»æ„ç±»å‹çš„æ•°æ®å›è°ƒäº†ï¼</strong>');
                
            } catch (error) {
                log(`âŒ é”™è¯¯: ${error.message}`);
                console.error(error);
            }
        }
        
        // è¿è¡Œæµ‹è¯•
        runTest();
    </script>
</body>
</html>
