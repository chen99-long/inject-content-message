<!DOCTYPE html>
<html>
<head>
    <title>修复后的测试</title>
    <script src="./dist/index.umd.js"></script>
</head>
<body>
    <h1>修复后的 sendEvent 测试</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            const div = document.createElement('div');
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            output.appendChild(div);
            console.log(message);
        }
        
        async function runTest() {
            try {
                const { defineEventMessaging } = InjectContentMessage;
                const { sendEvent, listenEvent } = defineEventMessaging();
                
                log('🎯 设置事件监听器...');
                
                // 监听器：处理消息并返回响应
                listenEvent("injectMessage", async (message) => {
                    log(`📨 监听器收到消息: ${JSON.stringify(message)}`);
                    return `Hello from inject script! 收到了: ${JSON.stringify(message)}`;
                });
                
                log('✅ 监听器设置完成');
                
                // 等待一下确保监听器已设置
                await new Promise(resolve => setTimeout(resolve, 200));

                sendEvent("injectMessage", "Hello from content script").then(res=>{
                    console.log(111,res);
                    
                })
                
                log('<br>📤 <strong>测试1: 发送字符串数据</strong>');
                const result1 = await sendEvent("injectMessage", "Hello from content script");
                log(`✅ 收到回调: <span style="color: green;">${result1}</span>`);
                
                log('<br>📤 <strong>测试2: 发送数字数据</strong>');
                const result2 = await sendEvent("injectMessage", 42);
                log(`✅ 收到回调: <span style="color: green;">${result2}</span>`);
                
                log('<br>📤 <strong>测试3: 发送对象数据</strong>');
                const result3 = await sendEvent("injectMessage", { type: "test", value: 123 });
                log(`✅ 收到回调: <span style="color: green;">${result3}</span>`);
                
                log('<br>📤 <strong>测试4: 发送布尔值</strong>');
                const result4 = await sendEvent("injectMessage", true);
                log(`✅ 收到回调: <span style="color: green;">${result4}</span>`);
                
                log('<br>🎉 <strong>所有测试完成！现在 sendEvent 支持任意类型的数据回调了！</strong>');
                
            } catch (error) {
                log(`❌ 错误: ${error.message}`);
                console.error(error);
            }
        }
        
        // 运行测试
        runTest();
    </script>
</body>
</html>
